# Sendinblue

## Why combine Sendinblue and Purchasely?

### Pre-requisites

The minimal version of the Purchasely SDK supporting this integration is v3.2.0. If the Purchasely SDK integrated in your app is under the minimal version, please update it.

The Sendinblue SDK also needs to be integrated inside the app.

### Subscription events

### General overview

[Sendinblue](https://www.sendinblue.com) is a customer engagement solutions for Email and CRM.

This integration will allow you to forward all Purchasely [subscription events](sendinblue.md#subscription-events) to Sendinblue.

This integration will allow you to get all Purchasely [subscription events](sendinblue.md#subscription-events) to Sendinblue making you able to trigger automated communication based on those events, messages that could be linked to a Purchasely powered paywall to engage, upsell, retain customers.

Purchasely provides a unified dataset to track the subscription events for all stores. These events are generated by the Purchasely Backend and can be sent to Sendinblue or used to update your Sendinblue users' properties.

![](<../.gitbook/assets/image (150) (1).png>)

Subscription events generated by Purchasely will be sent to Sendinblue using a server-to-server integration. As a result, you will be able to see all the subscription events along with your user's updated properties in your Sendinblue Dashboard and //TODO: Yoann

#### Events

The following events are the main ones that will trigger an udpate of your Sendinblue users by Purchasely. See the full list [here](../analytics/events/webhook-events/subscription-events.md).

| Event                           | Description                                                                                                              |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| SUBSCRIPTION\_STARTED           | Sent when the user purchased a product wether it is the start of a trial or a regular purchase of a consumable product.  |
| SUBSCRIPTION\_RENEWED           | Sent when a subscription renews                                                                                          |
| SUBSCRIPTION\_EXPIRED           | Sent when the subscription actually ends                                                                                 |
| SUBSCRIPTION\_REACTIVATED       | Sent when an expired subscription is reactivated. This event is particularly useful for win-back & retargeting campaigns |
| SUBSCRIPTION\_REFUNDED\_REVOKED | Sent when the subscription actually ends                                                                                 |
| RENEWAL\_DISABLED               | Sent when the user deactivates the renewal of a subscription wether it is in trial period or not.                        |
| RENEWAL\_ENABLED                | Sent when the user reactivates                                                                                           |
| TRIAL\_STARTED                  | Sent when a trial starts                                                                                                 |
| TRIAL\_CONVERTED                | Sent when a user converts from a free trial to a normal paid-period                                                      |
| TRIAL\_NOT\_CONVERTED           | Sent when a user finishes it's trial period without renewing to a paid-period                                            |

#### Properties

The following properties are the main ones this integration can set and update in your Sendinblue users as tags:

| Property                   | Description                                                                                                                                                                                                                                                                                                                                                   |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| USER\_ID                   | Contains the user\_id that holds the purchase.                                                                                                                                                                                                                                                                                                                |
| PLAN                       | Contains the _Plan id_ that was bought.                                                                                                                                                                                                                                                                                                                       |
| SUBSCRIPTION\_STATUS       | <p>Filled for events that regards a subscription.</p><p>Possible Values :</p><ul><li><code>AUTO_RENEWING</code></li><li><code>ON_HOLD</code></li><li><code>IN_GRACE_PERIOD</code></li><li><code>AUTO_RENEWING_CANCELED</code></li><li><code>DEACTIVATED</code></li><li><code>REVOKED</code></li><li><code>PAUSED</code></li><li><code>UNPAID</code></li></ul> |
| STORE                      | <p>Contains the name of the Store through which the purchase was made.</p><p>Possible values:</p><ul><li><code>APPLE_APP_STORE</code></li><li><code>GOOGLE_PLAY_STORE</code></li><li><code>AMAZON_APPSTORE</code></li><li><code>HUAWEI_APPGALLERY</code></li></ul>                                                                                            |
| STORE\_COUNTRY             | Contains the store country where the purchase was made.                                                                                                                                                                                                                                                                                                       |
| PURCHASED\_AT              | Contains the date of the last transaction (original purchase or renewal).                                                                                                                                                                                                                                                                                     |
| NEXT\_RENEWAL\_AT          | Contains the next automatic renewal date\*\*.\*\*                                                                                                                                                                                                                                                                                                             |
| OFFER\_TYPE                | <p>Contains the current offer the subscription is under.</p><p>Possible values:</p><ul><li><code>NONE</code>: the user is paying the normal price, no offer associated</li><li><code>FREE_TRIAL</code></li><li><code>INTRO_OFFER</code></li><li><code>PROMO_CODE</code></li></ul>                                                                             |
| GRACE\_PERIOD\_EXPIRES\_AT | Contains the date when the grace period will end.                                                                                                                                                                                                                                                                                                             |
| LAST\_EVENT                | Name of the last event received for that subscription                                                                                                                                                                                                                                                                                                         |
| IS\_FAMILY\_SHARED         | Contains true or false depending on if the user has access to the subscription thanks to family sharing.                                                                                                                                                                                                                                                      |
| OFFER\_IDENTIFIER          | Contains the promo code used at the time of the purchase.                                                                                                                                                                                                                                                                                                     |
| ORIGINAL\_PURCHASED\_AT    | Contains the date of the first transaction.                                                                                                                                                                                                                                                                                                                   |

The properties' names set in Sendinblue can be overriden when setting up the integration.

## **Integrating Purchasely with Sendinblue**

The integration requires 2 steps:

1. Associate the user to events by providing the email associated with the user in Sendiblue to the Purchasely SDK
2. Activate the Sendinblue integration in the Purchasely Console

### 1. Associating users to events

See the [Sendinblue Documentation](https://tracker-doc.sendinblue.com/docs) for more information

{% tabs %}
{% tab title="Swift" %}
```swift
Purchasely.setAttribute(.sendinblueUserEmail, value: "mail@company.com")
```
{% endtab %}

{% tab title="Kotlin" %}
```kotlin
 Purchasely.setAttribute(Attribute.SENDINBLUE_USER_EMAIL, "mail@company.com")
```
{% endtab %}

{% tab title="Java" %}
```java
 Purchasely.setAttribute(Attribute.SENDINBLUE_USER_EMAIL, "mail@company.com");
```
{% endtab %}

{% tab title="React Native" %}
```jsx
Purchasely.setAttribute(Attributes.SENDINBLUE_USER_EMAIL,  "mail@company.com");
```
{% endtab %}
{% endtabs %}

***

### 2. Activating the Sendinblue integration

The activation requires 2 steps:

1. Retrieving your app's id and API key in the Sendinblue Dashboard
2. Enabling the Sendinblue integration in the Purchasely Console

#### a. Retrieving your Sendiblue Tracker ID in the Sendinblue Dashboard

1. Log into your Sendinblue dashboard: [https://app.sendinblue.com/account/login](https://app.sendinblue.com/account/login)

2\. Access the Automation tab

![](<../.gitbook/assets/Screenshot 2022-07-04 at 23.41.52.png>)

3\. Go into the Settings, in the left menu

![](<../.gitbook/assets/Screenshot 2022-07-04 at 23.42.06.png>)

4\. Click on "Tracking Code" ![](<../.gitbook/assets/Screenshot 2022-07-04 at 23.42.22.png>)

5\. Extract your Sendinblue `MA Key` from the Javascript tracking code snippet (`client_key: "YOUR_SENDINBLUE_MA_KEY"`) ![](<../.gitbook/assets/Screenshot 2022-07-04 at 23.43.50.png>)

#### b. Enabling the Sendinblue integration in the Purchasely Console

1. Go in the "External integrations" section, and open the edition form for Sendinblue:

![](../.gitbook/assets/Screenshot%202022-05-23%20at%2023.10.51.png)

2\. Enable the integration

3\. Set your Sendinblue Tracker ID in the Sendinblue MA Key field

![](../.gitbook/assets/Screenshot%202022-05-23%20at%2023.11.31)

4\. Enable the events you want to be sent to Sendinblue

5\. (Optional) Override the names of the events that will be sent to Sendinblue

![](../.gitbook/assets/Screenshot%202022-05-23%20at%2023.11.40.png)

6\. Enable the properties you want to be set and updated as Sendinblue `properties` for your users

7\. (Optional) Override the property names that will be used when updating your users' Sendinblue `properties`

![](../.gitbook/assets/Screenshot%202022-05-23%20at%2023.13.47.png)

8\. Save

### Testing your integration

To test your integration, you can perform a set of in-app purchases in a Sandbox environment (eg: TestFlight for the App Store) and verify your user's `properties` are properly updated in the Sendinblue dashboard ( [https://app.sendinblue.com/account/login](https://app.sendinblue.com/account/login)).

//TODO: Thomas: Check if a similar warning is relevant for Sendinblue

{% hint style="info" %}
If testing using Automated Messages, bear in mind that xxxx automated messages are sent roughly every 4-6 hours if you are on a free plan, and within a few minutes if you are on a paid plan.
{% endhint %}
